#!/bin/sh

###
# Generated by Chef for [<%= node[:fqdn] %>]
# Environment: <%= node.chef_environment %>
###

# Loadbalancer statistics daemon start/stop script.

# Comments to support LSB init script conventions
### BEGIN INIT INFO
# Provides: lbstats-<%= @daemon %>
# Required-Start: $local_fs $network $remote_fs
# Required-Stop: $local_fs $network $remote_fs
# Default-Start:  2 3 4 5
# Default-Stop: 0 1 6
# Short-Description: start and stop loadbalancer statistics daemon
# Description: Loadbalancer statistics daemon
### END INIT INFO

PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin
DAEMON=<%= @daemon_path %>/<%= @daemon %>
DESC="Loadbalancer statistics daemon (<%= @daemon %>)"
VIRTUALENV=<%= @virtualenv %>

# Define LSB log_* functions.
. /lib/lsb/init-functions


if ! test -f $DAEMON
then
	log_failure_msg "Couldn't find daemon ($DAEMON)"
	exit 1
fi

if ! test -f $VIRTUALENV/bin/activate
then
	log_failure_msg "Couldn't find virtualenv ($VIRTUALENV)"
	exit 1
fi

case "$1" in
  start)
	log_daemon_msg "Starting $DESC"
	. $VIRTUALENV/bin/activate
	cd $(dirname $DAEMON)
	python $DAEMON start > /dev/null 2>&1
	RET=$?
	log_end_msg $RET
	exit $RET
	;;
  stop)
	log_daemon_msg "Stopping $DESC"
	. $VIRTUALENV/bin/activate
	cd $(dirname $DAEMON)
	python $DAEMON stop > /dev/null 2>&1
	RET=$?
	log_end_msg $RET
	exit $RET
	;;
  restart)
	log_daemon_msg "Restarting $DESC"
	. $VIRTUALENV/bin/activate
	cd $(dirname $DAEMON)
	python $DAEMON restart > /dev/null 2>&1
	RET=$?
	log_end_msg $RET
	exit $RET
	;;
  *)
	echo "Usage: $0 {start|stop|restart}"
	exit 1
	;;
esac
